FROM debian:8

MAINTAINER nikitasius "https://github.com/nikitasius"

RUN apt-get update
RUN apt-get -y upgrade
RUN apt-get install -y openssh-server vim mc iptables net-tools
RUN mkdir /var/run/sshd
RUN mkdir -p /home/evegate
RUN fallocate -l 100M /home/evegate.img
RUN mkfs /home/evegate.img
RUN useradd evegate -d /home/evegate
RUN printf "#!/bin/sh\niptables -I INPUT -s 192.168.1.4 -j DROP\niptables -I INPUT -s 172.17.0.1 -j DROP\niptables -A OUTPUT -d 13.32.0.0/15 -m owner --uid-owner 1000 -j ACCEPT\niptables -A OUTPUT -d 13.35.0.0/16 -m owner --uid-owner 1000 -j ACCEPT\niptables -A OUTPUT -d 52.46.0.0/18 -m owner --uid-owner 1000 -j ACCEPT\niptables -A OUTPUT -d 52.84.0.0/15 -m owner --uid-owner 1000 -j ACCEPT\niptables -A OUTPUT -d 52.222.128.0/17 -m owner --uid-owner 1000 -j ACCEPT\niptables -A OUTPUT -d 54.182.0.0/16 -m owner --uid-owner 1000 -j ACCEPT\niptables -A OUTPUT -d 54.192.0.0/16 -m owner --uid-owner 1000 -j ACCEPT\niptables -A OUTPUT -d 54.230.0.0/16 -m owner --uid-owner 1000 -j ACCEPT\niptables -A OUTPUT -d 54.239.128.0/18 -m owner --uid-owner 1000 -j ACCEPT\niptables -A OUTPUT -d 54.239.192.0/19 -m owner --uid-owner 1000 -j ACCEPT\niptables -A OUTPUT -d 54.240.128.0/18 -m owner --uid-owner 1000 -j ACCEPT\niptables -A OUTPUT -d 64.252.64.0/18 -m owner --uid-owner 1000 -j ACCEPT\niptables -A OUTPUT -d 70.132.0.0/18 -m owner --uid-owner 1000 -j ACCEPT\niptables -A OUTPUT -d 71.152.0.0/17 -m owner --uid-owner 1000 -j ACCEPT\niptables -A OUTPUT -d 143.204.0.0/16 -m owner --uid-owner 1000 -j ACCEPT\niptables -A OUTPUT -d 204.246.164.0/22 -m owner --uid-owner 1000 -j ACCEPT\niptables -A OUTPUT -d 204.246.168.0/22 -m owner --uid-owner 1000 -j ACCEPT\niptables -A OUTPUT -d 204.246.174.0/23 -m owner --uid-owner 1000 -j ACCEPT\niptables -A OUTPUT -d 204.246.176.0/20 -m owner --uid-owner 1000 -j ACCEPT\niptables -A OUTPUT -d 205.251.192.0/19 -m owner --uid-owner 1000 -j ACCEPT\niptables -A OUTPUT -d 205.251.249.0/24 -m owner --uid-owner 1000 -j ACCEPT\niptables -A OUTPUT -d 205.251.250.0/23 -m owner --uid-owner 1000 -j ACCEPT\niptables -A OUTPUT -d 205.251.252.0/23 -m owner --uid-owner 1000 -j ACCEPT\niptables -A OUTPUT -d 205.251.254.0/24 -m owner --uid-owner 1000 -j ACCEPT\niptables -A OUTPUT -d 216.137.32.0/19 -m owner --uid-owner 1000 -j ACCEPT\niptables -A OUTPUT -d 13.54.63.128/26 -m owner --uid-owner 1000 -j ACCEPT\niptables -A OUTPUT -d 13.59.250.0/26 -m owner --uid-owner 1000 -j ACCEPT\niptables -A OUTPUT -d 13.113.203.0/24 -m owner --uid-owner 1000 -j ACCEPT\niptables -A OUTPUT -d 13.124.199.0/24 -m owner --uid-owner 1000 -j ACCEPT\niptables -A OUTPUT -d 13.228.69.0/24 -m owner --uid-owner 1000 -j ACCEPT\niptables -A OUTPUT -d 18.216.170.128/25 -m owner --uid-owner 1000 -j ACCEPT\niptables -A OUTPUT -d 34.195.252.0/24 -m owner --uid-owner 1000 -j ACCEPT\niptables -A OUTPUT -d 34.216.51.0/25 -m owner --uid-owner 1000 -j ACCEPT\niptables -A OUTPUT -d 34.226.14.0/24 -m owner --uid-owner 1000 -j ACCEPT\niptables -A OUTPUT -d 34.232.163.208/29 -m owner --uid-owner 1000 -j ACCEPT\niptables -A OUTPUT -d 35.158.136.0/24 -m owner --uid-owner 1000 -j ACCEPT\niptables -A OUTPUT -d 35.162.63.192/26 -m owner --uid-owner 1000 -j ACCEPT\niptables -A OUTPUT -d 35.167.191.128/26 -m owner --uid-owner 1000 -j ACCEPT\niptables -A OUTPUT -d 52.15.127.128/26 -m owner --uid-owner 1000 -j ACCEPT\niptables -A OUTPUT -d 52.47.139.0/24 -m owner --uid-owner 1000 -j ACCEPT\niptables -A OUTPUT -d 52.52.191.128/26 -m owner --uid-owner 1000 -j ACCEPT\niptables -A OUTPUT -d 52.56.127.0/25 -m owner --uid-owner 1000 -j ACCEPT\niptables -A OUTPUT -d 52.57.254.0/24 -m owner --uid-owner 1000 -j ACCEPT\niptables -A OUTPUT -d 52.66.194.128/26 -m owner --uid-owner 1000 -j ACCEPT\niptables -A OUTPUT -d 52.78.247.128/26 -m owner --uid-owner 1000 -j ACCEPT\niptables -A OUTPUT -d 52.199.127.192/26 -m owner --uid-owner 1000 -j ACCEPT\niptables -A OUTPUT -d 52.212.248.0/26 -m owner --uid-owner 1000 -j ACCEPT\niptables -A OUTPUT -d 52.220.191.0/26 -m owner --uid-owner 1000 -j ACCEPT\niptables -A OUTPUT -d 54.233.255.128/26 -m owner --uid-owner 1000 -j ACCEPT\niptables -A OUTPUT -d 185.237.98.0/24 -m owner --uid-owner 1000 -j ACCEPT\niptables -A OUTPUT -d 87.237.34.0/24 -m owner --uid-owner 1000 -j ACCEPT\niptables -A OUTPUT -d 87.237.38.0/24 -m owner --uid-owner 1000 -j ACCEPT\niptables -A OUTPUT -d 8.8.8.8 -m owner --uid-owner 1000 -j ACCEPT\niptables -A OUTPUT -d 23.52.49.180 -m owner --uid-owner 1000 -j ACCEPT\niptables -A OUTPUT -d 52.218.16.164 -m owner --uid-owner 1000 -j ACCEPT\niptables -A OUTPUT -d 104.19.192.102 -m owner --uid-owner 1000 -j ACCEPT\niptables -A OUTPUT -d 205.185.208.52 -m owner --uid-owner 1000 -j ACCEPT\niptables -A OUTPUT -d 216.58.215.35 -m owner --uid-owner 1000 -j ACCEPT\niptables -A OUTPUT -d 216.58.213.132 -m owner --uid-owner 1000 -j ACCEPT\niptables -A OUTPUT -d 185.172.149.128 -m owner --uid-owner 1000 -j ACCEPT\niptables -A OUTPUT -d 64.71.168.251 -m owner --uid-owner 1000 -j ACCEPT\niptables -A OUTPUT -d 104.27.47.35 -m owner --uid-owner 1000 -j ACCEPT\niptables -A OUTPUT -d 209.197.3.15 -m owner --uid-owner 1000 -j ACCEPT\niptables -A OUTPUT -d 92.122.122.161 -m owner --uid-owner 1000 -j ACCEPT\niptables -A OUTPUT -d 23.43.24.236 -m owner --uid-owner 1000 -j ACCEPT\niptables -A OUTPUT -m owner --uid-owner 1000 -j DROP\nmount -o loop /home/evegate.img /home/evegate\nmkdir -p /home/evegate/.ssh\ntouch /home/evegate/.ssh/authorized_keys\nchmod 755 /home/evegate/.ssh\necho 'ssh-rsa AAAAB3NzaC1yc2EAAAABJQAAAgEAplVa/JkTB0iyiMkr+FOjZ1xlMl04ICqP9CjDn7xVSH5d3jy6lgLKhsI5jfAXNdGRa6XWLOt4AQN+/hSTD8Y++qc4nXJBlo9QDAq+89XvYyawZH3CG+pRFLiHt8iKni/WmZWcjVS7GqzLZNkgrC79N3g2sCBHkhy2yARrCJCW6n+mlT5Idzv37jl4Gv4KUcVDlWpIHIEvTlwOiyH2damiWNC5HTn+1XGX8eb1TiMVpD7DSxTEFtUPd2fvdRXJeZHf25ykMScyFtXtzASJjI8eFpHAEjzJk2DdVWkbet96WPdHdUvlwJb0UfWS5s2yect/2NiH5MQtDzExuna9jQpRDzVPa3WJha/vcMNaaH64DMYOh0vcCy/acoFSMdycoA7D11kr218exvAvXla0uBZ6vwMCMCjLNPaDVWKi/jH29FOl3f4pdCT/UhDMIx2xR7iw3POMtfvHdpxhKnaJ8gWIB+En8a2zvNn7CY36hDTl6exAnAu6V4peObPhgDSqeMjMhJ0ZUy8Ww5VrMaS7HC7+BogUd+/h0ltGkKriSuZOS4BNtvAeB/DJQdcdln+tqaz2RK7mHipz/aeJdtK8XPTv9zTZKv/r60SiT5Y4dPSR69mJCCq696SN9KKlmTRIyNCbG9+CQ0cNTNV83HiR4QgnzFu7d2pGS/t8HHGzyxAZpcc= shieldmaller putty' > /home/evegate/.ssh/authorized_keys\necho 'ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQCxPlU791bokZmmtzXL3XV9Ux12KgCZVAjxogAhSDDGvi+WDhTYr+WJihrDqLStvBoKMc/rAr2md0e3+XQdt9M3WnCxikD8DFHtc2LQH6H9nFvC/qAavBEq8thKrLnZno0U9X8PsO/JHyGRMQ752Wlzv4UdZErtyHrl1LZs1YkHfwkr1XmHMapRubZ0zfhgsE8eRHuc7G6B8bwSu8MQRK0SN6lkF1GASv+SNbWRHtkyBMg8hJODk2FyOWUST2i7iF0eF5EV14RN3agZvxfzdqGxIMbtmx2oScprS3lq4EwU03SFMvnb3YCQ5RkJ2JKnm/guSEVnvb2eUWpQZfJRjWoHEijX7TPFc4uHyBBcbV2iOoZhWcFEcwe2Es5dps94LD/r6N9L7mtMw5EZIODVtGL5hv21HZQz/a1REua03RmZaCu8/VaPc68WfxT7tX9WKIZOH2o2PZqAqBBp2ygW1tAVW3RU4Ek9qrjfFG/beHbz5TfzW+n4M+VWjqIU8MrG+3qwEN3Lqi/MyrHKgbJ29aFZldMT+JEvC+RTiTGKTShgVdnIbxxtDY+TJDPdamCfgTOtocjJefnnP9pJRf1YVt6epYwUeZxKG9sbnJ8Ux1Th2YZ6P0qrmlSiFuDyqaDeb3vsiwwffoOziT23ZgRNsnZvdp9oj3HKIT3O66xHMeOC4w== shieldmaller' >> /home/evegate/.ssh/authorized_keys\nchmod 644 /home/evegate/.ssh/authorized_keys\necho 'nameserver 8.8.8.8' > /etc/resolv.conf\necho '127.0.0.1 localhost' > /etc/hosts\necho '104.19.192.102 cdnjs.cloudflare.com' >> /etc/hosts\necho '205.185.208.52 code.jquery.com' >> /etc/hosts\necho '216.58.215.35 fonts.gstatic.com' >> /etc/hosts\necho '216.58.213.132 www.google.com' >> /etc/hosts\necho '185.172.149.128 discourse-cdn-sjc1.com' >> /etc/hosts\necho '64.71.168.251 www.discourse.org' >> /etc/hosts\necho '23.52.49.180 cdn.optimizely.com' >> /etc/hosts\necho '52.218.16.164 s3-eu-west-1.amazonaws.com' >> /etc/hosts\necho '64.71.168.251 corp.discourse.org' >> /etc/hosts\necho '104.27.47.35 discourse.org' >> /etc/hosts\necho '209.197.3.15 maxcdn.bootstrapcdn.com' >> /etc/hosts\necho '92.122.122.161 ocsp.int-x3.letserootncrypt.org' >> /etc/hosts\necho '23.43.24.236 ocsp.entrust.net' >> /etc/hosts\necho '216.58.215.35 www.gstatic.com' >> /etc/hosts\nexit 0" > /home/a
RUN chmod +x /home/a
RUN echo 'root:poney' |chpasswd
RUN sed -ri 's/^PermitRootLogin\s+.*/PermitRootLogin yes/' /etc/ssh/sshd_config
RUN sed -ri 's/^PubkeyAuthentication\s+.*/PubkeyAuthentication yes/' /etc/ssh/sshd_config
RUN sed -ri 's/^RSAAuthentication\s+.*/RSAAuthentication yes/' /etc/ssh/sshd_config
RUN echo 'ClientAliveInterval 120' >> /etc/ssh/sshd_config
RUN echo 'ClientAliveCountMax 7200' >> /etc/ssh/sshd_config

EXPOSE 22
CMD    ["/usr/sbin/sshd", "-D"]